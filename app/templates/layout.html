<!DOCTYPE html>
<html lang="en">
<head>
    {% include 'include/head.html' %}
</head>
<body id="page-top">
<div class="container-fluid">
    {% include 'include/navigation.html' %}

    {% block body %}

    {% endblock %}
    <div class="push"></div>
</div>

<div id="contact">
    {% include 'include/footer.html' %}
</div>
</body>
<div class="loader"></div>
<style>
    .loader {
        position: fixed;
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        z-index: 99999;
        background: url("{{ url_for('static', filename = 'assets/page-loader.gif') }}") 50% 50% no-repeat rgb(249, 249, 249);
    }
</style>
</html>
<script>
    var marker;
    var heatmap_active = 0;
    var map = undefined;
    var cfg = {
        // radius should be small ONLY if scaleRadius is true (or small radius is intended)
        // if scaleRadius is false it will be the constant radius used in pixels
        "radius": 0.1,
        "maxOpacity": .8,
        // scales the radius based on map zoom
        "scaleRadius": true,
        // if set to false the heatmap uses the global maximum for colorization
        // if activated: uses the data maximum within the current map boundaries
        //   (there will always be a red spot with useLocalExtremas true)
        "useLocalExtrema": true,
        // which field name in your data represents the latitude - default "lat"
        latField: 'lat',
        // which field name in your data represents the longitude - default "lng"
        lngField: 'lng',
        // which field name in your data represents the data value - default "value"
        valueField: 'count'
    };
    var heatmapLayer = new HeatmapOverlay(cfg);
    var baseLayer = L.tileLayer(
            'http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                maxZoom: 18
            }
    );

    var jsonArr = [];
    data_array = {
        max: 3000,
        data: ''
    };

    heatmapLayer.setData(data_array);

    $('#heatmap').on('click', function (e) {
        $(this).addClass('btn-selected-territory');
        e.preventDefault();
        $('.tabs_table').hide();
        $('#all-results').removeClass('disabled-link');
        $('#all-results').addClass('btn-selected-territory');
        $('#all-results').removeAttr('disabled');
        $('.default-first-indicators').hide();
        $('.party_name').removeClass('select-p-tab');
        {% if year==2016 %}
        $("a[href*=aleksandar-vucic-srbija-pobeduje]").addClass('select-p-tab');
        {% endif %}
        {% if year==2017 %}
            $("a[href*=aleksandar-vucic]").addClass('select-p-tab');
        {% endif %}
        $('#containermap').hide();
        $('#containerheatmap').show();

        if (heatmap_active == 0) {
            map = new L.Map('containerheatmap', {
                center: new L.LatLng(44.787197, 20.457273),
                zoom: 7,
                layers: [baseLayer, heatmapLayer]
            });


            heatmap_active = 1;
        }

        $.ajax({
            type: "GET",
                {% if year==2016 %}
            url: "{{ url_for("static",filename="data/parlamentarni/") }}2016.json",
                {% endif %}
             {% if year==2017 %}
            url: "{{ url_for("static",filename="data/presidential/") }}2017-prvi-krug.json",
             {% endif %}
            async: false,
            dataType: 'json',
            success: function (response) {
                jsonArr = [];
                heatmapLayer.setData({
                    max: 3000,
                    data: []
                });
                $(response['winners']).each(function (key, value) {
                    $(value['rezultat']).each(function (a, b) {
                        var lat = value['coordinates'].split(",")[0];
                        var lng = value['coordinates'].split(",")[1];
                        if (b['izbornaListaSlug'] == "aleksandar-vucic-srbija-pobeduje") {
                            if (lat != "" && lng != "") {
                                jsonArr.push({
                                    lat: lat,
                                    lng: lng,
                                    count: b['rezultat']['udeo']
                                });
                            }
                        }
                         if (b['kandidatSlug'] == "aleksandar-vucic") {
                            if (lat != "" && lng != "") {
                                jsonArr.push({
                                    lat: lat,
                                    lng: lng,
                                    count: b['rezultat']['udeo']
                                });
                            }
                        }
                    })

                })
                data_array = {
                    max: 3000,
                    data: jsonArr
                };
                console.log(data_array);
                heatmapLayer.setData(data_array);
            },
            error: function (error) {
                console.log(error);
            }
        });

    });


    var $iW = $(window).innerWidth();
     function transliterateToEnglish(word) {
        var A = {};
        var result = '';
        A["Ё"] = "E";
        A["Й"] = "I";
        A["Ц"] = "C";
        A["У"] = "U";
        A["К"] = "K";
        A["Е"] = "E";
        A["Н"] = "N";
        A["Г"] = "G";
        A["Ш"] = "S";
        A["Щ"] = "D";
        A["З"] = "Z";
        A["Х"] = "H";
        A["Ъ"] = "L";
        A["ё"] = "yo";
        A["й"] = "i";
        A["ц"] = "c";
        A["у"] = "u";
        A["к"] = "k";
        A["е"] = "e";
        A["н"] = "n";
        A["г"] = "g";
        A["ш"] = "s";
        A["щ"] = "d";
        A["з"] = "z";
        A["х"] = "h";
        A["ъ"] = "l";
        A["Ф"] = "F";
        A["Ы"] = "I";
        A["В"] = "V";
        A["А"] = "A";
        A["П"] = "P";
        A["Р"] = "R";
        A["О"] = "O";
        A["Л"] = "L";
        A["Д"] = "D";
        A["Ж"] = "Z";
        A["Э"] = "E";
        A["Ђ"] = "D";
        A["Ћ"] = "C";
        A["Њ"] = "N";
        A["ф"] = "f";
        A["ы"] = "i";
        A["в"] = "v";
        A["а"] = "a";
        A["п"] = "p";
        A["р"] = "r";
        A["о"] = "o";
        A["л"] = "l";
        A["д"] = "d";
        A["ж"] = "z";
        A["э"] = "e";
        A["ђ"] = "c";
        A["ћ"] = "c";
        A["њ"] = "n"
        A["Я"] = "YA";
        A["Ч"] = "C";
        A["С"] = "S";
        A["М"] = "M";
        A["И"] = "I";
        A["Т"] = "T";
        A["Ь"] = "'";
        A["Б"] = "B";
        A["Ю"] = "YU";
        A["Љ"] = "L";
        A["Џ"] = "D";
        A["џ"] = "d";
        A["я"] = "ya";
        A["ч"] = "c";
        A["с"] = "s";
        A["м"] = "m";
        A["и"] = "i";
        A["т"] = "t";
        A["ь"] = "'";
        A["б"] = "b";
        A["ю"] = "yu";
        A["љ"] = "l";
        for (var i = 0; i < word.length; i++) {
            var c = word.charAt(i);
            result += A[c] || c;
        }
        return result;
    }

    function transliterate(word) {
        var A = {};
        var result = '';
        A["Ё"] = "YO";
        A["Й"] = "I";
        A["Ц"] = "C";
        A["У"] = "U";
        A["К"] = "K";
        A["Е"] = "E";
        A["Н"] = "N";
        A["Г"] = "G";
        A["Ш"] = "Š";
        A["Щ"] = "Dž";
        A["З"] = "Z";
        A["Х"] = "H";
        A["Ъ"] = "Lj";
        A["ё"] = "yo";
        A["й"] = "i";
        A["ц"] = "c";
        A["у"] = "u";
        A["к"] = "k";
        A["е"] = "e";
        A["н"] = "n";
        A["г"] = "g";
        A["ш"] = "š";
        A["щ"] = "dž";
        A["з"] = "z";
        A["х"] = "h";
        A["ъ"] = "lj";
        A["Ф"] = "F";
        A["Ы"] = "I";
        A["В"] = "V";
        A["А"] = "A";
        A["П"] = "P";
        A["Р"] = "R";
        A["О"] = "O";
        A["Л"] = "L";
        A["Д"] = "D";
        A["Ж"] = "Ž";
        A["Э"] = "E";
        A["Ђ"] = "Đ";
        A["Ћ"] = "Ć";
        A["Њ"] = "Nj";
        A["ф"] = "f";
        A["ы"] = "i";
        A["в"] = "v";
        A["а"] = "a";
        A["п"] = "p";
        A["р"] = "r";
        A["о"] = "o";
        A["л"] = "l";
        A["д"] = "d";
        A["ж"] = "ž";
        A["э"] = "e";
        A["ђ"] = "đ";
        A["ћ"] = "ć";
        A["њ"] = "nj";
        A["Я"] = "YA";
        A["Ч"] = "Č";
        A["С"] = "S";
        A["М"] = "M";
        A["И"] = "I";
        A["Т"] = "T";
        A["Ь"] = "'";
        A["Б"] = "B";
        A["Ю"] = "YU";
        A["Љ"] = "Lj";
        A["Џ"] = "Dž";
        A["џ"] = "dž";
        A["я"] = "ya";
        A["ч"] = "č";
        A["с"] = "s";
        A["м"] = "m";
        A["и"] = "i";
        A["т"] = "t";
        A["ь"] = "'";
        A["б"] = "b";
        A["ю"] = "yu";
        A["љ"] = "lj";
        for (var i = 0; i < word.length; i++) {
            var c = word.charAt(i);
            result += A[c] || c;
        }
        return result;
    }

    function fill_html(response) {
        $('#piechart-no-territory-selected .x7').css('width', response['percentage'].toFixed(2) + '%');
        $('#piechart-no-territory-selected .x8').css('width', 100 - response['percentage'].toFixed(2) + '%');
        $('#piechart-no-territory-selected .total_percentage_value').html(response['percentage'].toFixed(2));
        $('#piechart-no-territory-selected .total_voters_value').html(response['total_voters'].toLocaleString());
        var arrayLength = response.length;
        $.each(response['candidates'], function (index, value) {
            {% if typeizbori=="parlamentarni" %}
                {% if g.current_lang=="en" %}

                    $('#party-list-names').append('<li style="font-size:15px;"><a href=' + value['izbornaListaSlug'] + ' class="party_name">' + transliterateToEnglish(value['izbornaLista']) + '</a></li>');
                        {% else %}
                    $('#party-list-names').append('<li style="font-size:15px;"><a href=' + value['izbornaListaSlug'] + ' class="party_name">' + value['izbornaLista'] + '</a></li>');
                {% endif %}
            {% else %}
                {% if g.current_lang=="en" %}
                    $('#party-list-names').append('<li style="font-size:15px;"><a href=' + value['kandidatSlug'] + ' class="party_name">' + transliterateToEnglish(value['kandidat']) + '</a></li>');
                    {% else %}
                    $('#party-list-names').append('<li style="font-size:15px;"><a href=' + value['kandidatSlug'] + ' class="party_name">' + value['kandidat'] + '</a></li>');
                    {% endif %}
                {% endif %}
        });
        $('.first-progress').css('background-color', response['candidates'][0]['boja']);
        $('.second-progress').css('background-color', response['candidates'][1]['boja']);
        {% if typeizbori=="parlamentarni" %}
            {% if g.current_lang=="en" %}
                    $('.name-list1').text(transliterateToEnglish(response['candidates'][0]['izbornaLista']));
                    $('.name-list2').text(transliterateToEnglish(response['candidates'][1]['izbornaLista']));
                 {% else %}
                    $('.name-list1').text(response['candidates'][0]['izbornaLista']);
                    $('.name-list2').text(response['candidates'][1]['izbornaLista']);

            {% endif %}
        {% else %}
            {% if g.current_lang=="en" %}
            $('.name-list1').text(transliterateToEnglish(response['candidates'][0]['kandidat']));
            $('.name-list2').text(transliterateToEnglish(response['candidates'][1]['kandidat']));
                {% else %}
                     $('.name-list1').text(response['candidates'][0]['kandidat']);
                    $('.name-list2').text(response['candidates'][1]['kandidat']);
                {% endif %}
        {% endif %}
        $('.name-list1,.nr-votes1, #first-percentage-value-main').css('color', response['candidates'][0]['boja']);
        $('.name-list2,.nr-votes2, #second-percentage-value-main').css('color', response['candidates'][1]['boja']);

        var nr_votes_1 = response['candidates'][0]['glasova'].toLocaleString();
        var nr_votes_2 = response['candidates'][1]['glasova'].toLocaleString();
        $('.nr-votes1').text(nr_votes_1);
        $('.nr-votes2').text(nr_votes_2);
        var udeo1 = response['candidates'][0]['udeo'];
        var udeo2 = response['candidates'][1]['udeo'];
        $('.first-progress').css('width', udeo1.toFixed(2) + '%');
        $('.second-progress').css('width', udeo2.toFixed(2) + '%');
        $('#first-percentage-value-main').html(udeo1.toFixed(2) + '%');
        $('#second-percentage-value-main').html(udeo2.toFixed(2) + '%');
        $('.party_name').on('click', function (e) {
            var selected_candidate = $(this).attr('href');
            e.preventDefault();
            if ($iW < 990) {
                $('html, body').animate({scrollTop: 0}, 'slow');
            }
            $('#party-list-names li a').removeClass('select-p-tab');

            $('#containermap').html('');
            $(this).addClass('select-p-tab');

            $('.territory_info').hide();
            if (heatmap_active === 1) {
                jsonArr = [];
                data_array = {
                    max: 3000,
                    data: ''
                };
                heatmapLayer.setData(data_array);
                $('.default-first-indicators').hide();
                {% if year==2016 %}
                $("a[href*=aleksandar-vucic-srbija-pobeduje]").removeClass('select-p-tab');
                $("a[href*=aleksandar-vucic-srbija-pobeduje]").addClass('select-p-tab-heatmap');
                {% endif %}
               {% if year==2017 %}
                $("a[href*=aleksandar-vucic]").removeClass('select-p-tab');
                $("a[href*=aleksandar-vucic]").addClass('select-p-tab-heatmap');
                {% endif %}

                $('.select-p-tab-heatmap').on('click', function () {
                    $(this).addClass('select-p-tab');
                })
                $.ajax({
                    type: "GET",
                    {%  if year==2016 %}
                    url: "{{ url_for("static",filename="data/parlamentarni/") }}2016.json",
                    {% endif %}
                   {%  if year==2017 %}
                     url: "{{ url_for("static",filename="data/presidential/") }}2017-prvi-krug.json",
                    {% endif %}
                    async: false,
                    dataType: 'json',
                    success: function (response) {
                        jsonArr = [];
                        heatmapLayer.setData({
                            max: 3000,
                            data: []
                        });
                        $(response['winners']).each(function (key, value) {
                            $(value['rezultat']).each(function (a, b) {
                                var lat = value['coordinates'].split(",")[0];
                                var lng = value['coordinates'].split(",")[1];
                                {% if year==2016 %}
                                if (b['izbornaListaSlug'] == selected_candidate) {
                                    if (lat != "" && lng != "") {
                                        jsonArr.push({
                                            lat: lat,
                                            lng: lng,
                                            count: b['rezultat']['udeo']
                                        });
                                    }
                                }
                                {% endif %}
                                {% if year==2017 %}
                                    if (b['kandidatSlug'] == selected_candidate) {
                                    if (lat != "" && lng != "") {
                                        jsonArr.push({
                                            lat: lat,
                                            lng: lng,
                                            count: b['rezultat']['udeo']
                                        });
                                    }
                                }
                                {% endif %}
                            })

                        })

                        data_array = {
                            max: 3000,
                            data: jsonArr
                        };
                        console.log(data_array);
                        heatmapLayer.setData(data_array);
                    },
                    error: function (error) {
                        console.log(error);
                    }
                });

            } else {
                reinit_map(response, selected_candidate);
            }
        })
    }

    function reinit_map(response, selected_candidate) {
        $('.party_info').hide();
        $.getJSON('{{ url_for("static",filename="data/serbia-municipality.geojson") }}', function (geojson) {
            var data = [];
            {%  if typeizbori=="parlamentarni" %}
                $(response['winners']).each(function (index, value) {
                    $(value['rezultat']).each(function (a, b) {
                        if (b['izbornaListaSlug'] == selected_candidate) {
                            data.push({
                                "teritorija": transliterate(value['teritorija']),
                                "terrigorySlug": transliterate(value['teritorijaSlug']),
                                "value": b['rezultat']['udeo'],
                                "izbornaLista": selected_candidate
                            });
                        }
                    })
                })
            {% else %}
                $(response['winners']).each(function (index, value) {
                    $(value['rezultat']).each(function (a, b) {
                        if (b['kandidatSlug'] == selected_candidate) {
                            data.push({
                                "teritorija": transliterate(value['teritorija']),
                                "terrigorySlug": transliterate(value['teritorijaSlug']),
                                "value": b['rezultat']['udeo'],
                                "izbornaLista": selected_candidate
                            });
                        }
                    })
                })
            {% endif %}


            $('#containermap').highcharts('Map', {
                chart: {
                    events: {
                        load: function () {
                            this.mapZoom(0.5, 21, -44);
                        }

                    },
                    backgroundColor: {
                        linearGradient: {x1: 0, y1: 0, x2: 0, y2: 1},
                        stops: [
                            [0, '#edecd1'],
                            [1, '#edecd1']
                        ]
                    }
                },
                title: {
                    text: ''
                },
                tooltip: {
                    'enabled': false
                },
                plotOptions: {
                    series: {
                        cursor: 'pointer',
                        point: {
                            events: {
                                click: function () {
                                    var terrritory_selected_slug = this.terrigorySlug;
                                    var terrritory_selected = this.teritorija;
                                    var izbornaLista = this.izbornaLista;

                                    on_reinit_map_click(response, terrritory_selected_slug, this.izbornaLista, terrritory_selected);
                                }
                            }
                        }
                    }
                },
                mapNavigation: {
                    enableMouseWheelZoom: false,
                    enabled: true,
                    buttonOptions: {
                        verticalAlign: 'bottom'
                    }
                },
                colorAxis: {
                    min: 0
                },
                series: [{
                    showInLegend: true,
                    data: data,
                    mapData: geojson,
                    joinBy: ['NAME_2', 'teritorija'],
                    keys: ['NAME_2', 'NAME_1'],
                    animation: true,
                    name: 'Teritorija',
                    {#dataLabels: {
                        enabled: true,
                        color: '#FFFFFF',
                        format: '{point.NAME_2}'
                    },#}
                }]
            });
        })
    }
    // details table
    {%  if typeizbori=="parlamentarni" %}
        function init_details_table(response) {
            var init_candidates = [];
            $(response['candidates']).each(function (a, b) {
                if (a <= 4) {
                        init_candidates.push({
                            'id': 'selected_' + b['izbornaListaSlug'],
                            {% if g.current_lang=="en" %}
                                'text': transliterateToEnglish(b['izbornaLista']),
                                {% else %}
                                'text': b['izbornaLista'],
                            {% endif %}
                            'selected': true
                        });
                }
                $("#select2").append('<option value="selected_' + b['izbornaListaSlug'] + '">' + b['izbornaLista'] + '</option>');

            })

            $("#select2").select2("data", init_candidates);

            // draw table on load depending on selected parties
            var data = $('#select2').select2('data');

            // draw table on load depending on selected parties

            // draw table on click of select2
            var last_element;
            $('#select2').on('click', function (e) {
                var dataclicked = $('#select2').select2('data');
                $("#select2").select2("data", dataclicked);
                $('.data-th').css('display', 'none');
                $('.data_glasova').css('display', 'none');
                $(dataclicked).each(function (key, index) {
                    $('.' + index['id']).show();
                    $('.' + index['id']).show();
                    $('#selected_later_' + index['id']).show();
                })
            })

            $('#details').on('draw.dt', function () {
                var data = $('#select2').select2('data');
                $(data).each(function (key, index) {
                    $('.' + index['id']).show();

                })
                $('.paginate_button').on('click', function () {
                    var data1 = $('#select2').select2('data');

                    $(data1).each(function (key1, index1) {
                        $('.' + index1['id']).show();

                    })
                });
            })
            var arraylength = 0;
            arraylength = response['candidates'].length - 1;

            for (var i = 0; i <= arraylength; i++) {
                {% if g.current_lang=="en" %}
                    $('#details thead tr').append('<th style="display:none" class="data-th selected_' + response['candidates'][i]['izbornaListaSlug'] + '">' +transliterateToEnglish(response['candidates'][i]['izbornaLista']) + '</th>');

                {% else %}
                     $('#details thead tr').append('<th style="display:none" class="data-th selected_' + response['candidates'][i]['izbornaListaSlug'] + '">' +response['candidates'][i]['izbornaLista'] + '</th>');
                {% endif %}
            }

            var territories = [];

            $(response['winners']).each(function (key22, index22) {
                territories.push({
                    "territory": index22['teritorija'],
                    "territoryslug": index22['teritorijaSlug'],
                    "rezultat": index22['rezultat']
                });
            });
            var createdarray = [];
            var candidatesterritory_glasova = "";
            var territory = "";
            var territoryslug = "";
            var mergearray = [];
            $(territories).each(function (aa, index) {
                territory = index['territory'];
                territoryslug = index['territoryslug'];
                //$('#details tbody').append('<tr><td>'+index['territory']+'</td></tr>');
                $(response['candidates']).each(function (a, b) {
                    $(index['rezultat']).each(function (c, d) {
                        if (b['izbornaLista'] == d['izbornaLista']) {
                            candidatesterritory_glasova = d['rezultat']['glasova'];
                            //$('#details tbody tr').append('<td>'+d['rezultat']['glasova']+'</td>');

                                createdarray.push({
                                    "territory": territory,
                                    "territoryslug": territoryslug,
                                    'glasova': candidatesterritory_glasova,
                                    'candidate': d['izbornaListaSlug'],
                                    'boja': d['boja']

                                });

                        }
                    })

                })

                var exists_territory = "";
                var exists_territory_slug = "";
                var glasova = [];

                max_glasova = [];
                var find_max;

                function getMax(array) {
                    return Math.max.apply(Math, array);
                }

                $(createdarray).each(function (a, b) {
                    if (index['territoryslug'] == b['territoryslug']) {
                        max_glasova.push(b[['glasova']]);
                            exists_territory = b['territory'];
                        exists_territory_slug = b['territoryslug'];
                        glasova.push({'glasova': b['glasova'], 'candidate': b['candidate'], 'boja': b['boja']});

                    }
                });
                var boja_selected = "";
                $(glasova).each(function (a, b) {
                    if (b['glasova'] >= getMax(max_glasova)) {
                        boja_selected = b['boja'];
                    }
                })

                mergearray.push({
                    'territory': exists_territory,
                    'rezults': glasova,
                    'territoryslug': exists_territory_slug,
                    'boja': boja_selected
                });

            })

            $(mergearray).each(function (a, b) {
                if (b['territory'] != "") {
                    {% if g.current_lang=="en" %}
                            $('#details tbody').append('<tr class=' + b['territoryslug'] + '><td>' + transliterateToEnglish(b['territory']) + '</tr>');
                        {% else %}
                            $('#details tbody').append('<tr class=' + b['territoryslug'] + '><td>' + b['territory'] + '</tr>');
                    {% endif %}
                    $(b['rezults']).each(function (aa, bb) {

                        if (aa <= arraylength) {
                            var color = "";
                            if (b['boja'] == bb['boja']) {
                                color = bb['boja'];
                            }
                            $('#details tbody tr.' + b['territoryslug']).append('<td  href="#" data-territory-slug=' + b['territoryslug'] + ' data-territory=' + b['territory'] + ' data-candidate=' + bb['candidate'] + ' style="display:none;background:' + color + '" class="data_glasova selected_' + bb['candidate'] + ' territory_redirect"><a  href="#">' + bb['glasova'].toLocaleString() + '</a></td>');
                        }
                    })
                }
            })
            function init_map_territory_selected(response, selected_territory, selected_candidate) {
                $('.party_info').hide();
                var chart;
                $.getJSON('{{ url_for("static",filename="data/serbia-municipality.geojson") }}', function (geojson) {
                    var data = [];
                    var data1 = [];
                    $(response['winners']).each(function (index, value) {
                        $(value['rezultat']).each(function (a, b) {
                            if (selected_territory == value['teritorija'] && b['izbornaListaSlug'] == selected_candidate) {
                                data.push
                                ({
                                    "teritorija": transliterate(value['teritorija']),
                                    "terrigorySlug": transliterate(value['teritorijaSlug']),
                                    "value": b['rezultat']['udeo'],
                                    "izbornaLista": selected_candidate,
                                    'color': b['boja'],
                                    'plotBorderColor': 'blue',
                                    'borderColor': "blue",
                                    'plotBackgroundColor': 'blue',
                                    'fill': 'white',
                                    'selected_territorija': 'true',
                                    'borderWidth': 20,

                                });

                            } else if (b['izbornaListaSlug'] == selected_candidate) {
                                data.push({
                                    "teritorija": transliterate(value['teritorija']),
                                    "terrigorySlug": transliterate(value['teritorijaSlug']),
                                    "value": b['rezultat']['udeo'],
                                    "izbornaLista": selected_candidate,

                                    'dataLabels': ''
                                });
                            }
                        })

                    })

                    chart = $('#containermap').highcharts('Map', {
                        chart: {
                            events: {
                                load: function () {
                                    this.mapZoom(0.5, 21, -44);
                                }

                            },
                            backgroundColor: {
                                linearGradient: {x1: 0, y1: 0, x2: 0, y2: 1},
                                stops: [
                                    [0, '#edecd1'],
                                    [1, '#edecd1']
                                ]
                            },

                        },
                        title: {
                            text: ''
                        },
                        tooltip: {
                            'enabled': false
                        },
                        plotOptions: {
                            series: {
                                dataLabels: {
                                    enabled: true,
                                    useHTML: true,
                                    formatter: function () {

                                        if (transliterate(selected_territory) == this.point.NAME_2) {
                                            {% if g.current_lang=="en" %}
                                                return ("<span  style='padding:20px;overflow: auto;display:block;background:white;border-radius:3px;'><a href='#' class='remove-popup'><img style='float:right;margin-top:-15px;margin-right:-14px;'src='{{ url_for('static', filename = 'assets/popup-close.png') }}'/></a><span class='datalabel' style='float:left;color:black;'>" + transliterateToEnglish(selected_territory) + "</span></span><div id='Feature Popup_FrameDecorationDiv_4' style='position: absolute; overflow: hidden; width: 81px; height: 35px; left: 0px;'><img src='{{ url_for('static', filename = 'assets/arrow-popup.png') }}' style='width: 1276px; height: 736px; position: absolute; left: -215px; top: -690px;'/></div>");
                                            {% else %}
                                                return ("<span  style='padding:20px;overflow: auto;display:block;background:white;border-radius:3px;'><a href='#' class='remove-popup'><img style='float:right;margin-top:-15px;margin-right:-14px;'src='{{ url_for('static', filename = 'assets/popup-close.png') }}'/></a><span class='datalabel' style='float:left;color:black;'>" + selected_territory + "</span></span><div id='Feature Popup_FrameDecorationDiv_4' style='position: absolute; overflow: hidden; width: 81px; height: 35px; left: 0px;'><img src='{{ url_for('static', filename = 'assets/arrow-popup.png') }}' style='width: 1276px; height: 736px; position: absolute; left: -215px; top: -690px;'/></div>");
                                            {% endif %}
                                        }
                                    }
                                },
                                allowPointSelect: true,
                                cursor: 'pointer',
                                point: {
                                    events: {
                                        click: function () {
                                            var terrritory_selected_slug = this.terrigorySlug;
                                            var terrritory_selected = this.teritorija;
                                            var izbornaLista = this.izbornaLista;

                                            on_reinit_map_click(response, terrritory_selected_slug, this.izbornaLista, terrritory_selected);
                                        }
                                    }
                                }
                            }
                        },
                        mapNavigation: {
                            enableMouseWheelZoom: false,
                            enabled: true,
                            buttonOptions: {
                                verticalAlign: 'bottom'
                            }
                        },
                        colorAxis: {
                            min: 0
                        },
                        {# tooltip : {
                            formatter: function() {
                                    console.log(this.point);
                                    tooltip =  '<span style="color:{point.color}">●</span> <span style="font-size: 0.85em;position:fixed;display:block;">'+this.point.NAME_2+'</span><br/>';

                            }
                        },#}
                        series: [{
                            data: data,
                            mapData: geojson,
                            joinBy: ['NAME_2', 'teritorija'],
                            keys: ['NAME_2', 'NAME_1'],
                            //animation: true,
                            name: 'Teritorija',

                            {#  dataLabels: {
                                 enabled: true,
                                 color: '#FFFFFF',

                             }#}
                        }],
                    });
                }).done(function () {
                    $('.remove-popup').on('click', function (e) {
                        e.preventDefault();
                        e.stopPropagation();
                        $('.party_name').removeClass('select-p-tab');
                        $('#start-map').addClass('select-p-tab');
                        init_results(response);
                    })

                });
            }

            $('.territory_redirect').on("click", function (e) {
                e.preventDefault();
                var territory_slug = $(this).data("territory-slug");
                var territory = $(this).data("territory");
                var candidate = $(this).data("candidate");
                $('#containermap').html('');
                $('.party_info').show();
                var territorija = [];
                $(response['winners']).each(function (key, index) {
                    if (territory_slug == index['teritorijaSlug']) {
                        territorija.push(index);
                    }
                });
                $('.party_name').removeClass('select-p-tab');
                init_map_territory_selected(response, territory, candidate);
                //console.log(response['winners']);
                $(response['winners']).each(function (index, value) {
                    $(value['rezultat']).each(function (index1, value1) {
                        if (candidate == value1['izbornaListaSlug'] && territory == value['teritorija']) {
                        }
                    })
                    // console.log(value['teritorija']);
                    // console.log(territory);
                })
                winner_territory_info(response, territorija, candidate);
                $('html, body').animate({scrollTop: 0}, 'slow');
                $('.party_info').show();
                $('#start-map').removeClass('select-p-tab');
                $('.party_name').removeClass('select-p-tab');
                $("a[href=" + candidate + "]").addClass('select-p-tab');

            });
        }
    {% else %}
        function init_details_table(response) {
            var init_candidates = [];
            $(response['candidates']).each(function (a, b) {
                if (a <= 4) {
                        {% if g.current_lang=="en" %}
                            init_candidates.push({
                                'id': 'selected_' + b['kandidatSlug'],
                                'text': transliterateToEnglish(b['kandidat']),
                                'selected': true
                            });
                        {% else %}
                               init_candidates.push({
                                'id': 'selected_' + b['kandidatSlug'],
                                'text': b['kandidat'],
                                'selected': true
                            });
                        {% endif %}
                }
                $("#select2").append('<option value="selected_' + b['kandidatSlug'] + '">' + transliterateToEnglish(b['kandidat']) + '</option>');

            })

            $("#select2").select2("data", init_candidates);

            // draw table on load depending on selected parties
            var data = $('#select2').select2('data');

            // draw table on load depending on selected parties

            // draw table on click of select2
            var last_element;
            $('#select2').on('click', function (e) {
                var dataclicked = $('#select2').select2('data');
                $("#select2").select2("data", dataclicked);
                $('.data-th').css('display', 'none');
                $('.data_glasova').css('display', 'none');
                $(dataclicked).each(function (key, index) {
                    $('.' + index['id']).show();
                    $('.' + index['id']).show();
                    $('#selected_later_' + index['id']).show();
                })
            })

            $('#details').on('draw.dt', function () {
                var data = $('#select2').select2('data');
                $(data).each(function (key, index) {
                    $('.' + index['id']).show();

                })
                $('.paginate_button').on('click', function () {
                    var data1 = $('#select2').select2('data');

                    $(data1).each(function (key1, index1) {
                        $('.' + index1['id']).show();

                    })
                });
            })

            var arraylength = 0;
            arraylength = response['candidates'].length - 1;
            for (var i = 0; i <= arraylength; i++) {
                {% if g.current_lang=="en" %}
                    $('#details thead tr').append('<th style="display:none" class="data-th selected_' + response['candidates'][i]['kandidatSlug'] + '">' + transliterateToEnglish(response['candidates'][i]['kandidat']) + '</th>');
                {% else %}
                    $('#details thead tr').append('<th style="display:none" class="data-th selected_' + response['candidates'][i]['kandidatSlug'] + '">' + response['candidates'][i]['kandidat'] + '</th>');
                {% endif %}
            }
            var territories = [];

            $(response['winners']).each(function (key22, index22) {
                territories.push({
                    "territory": index22['teritorija'],
                    "territoryslug": index22['teritorijaSlug'],
                    "rezultat": index22['rezultat']
                });
            })

            var createdarray = [];
            var candidatesterritory_glasova = "";
            var territory = "";
            var territoryslug = "";
            var mergearray = [];
            $(territories).each(function (aa, index) {

                territory = index['territory'];

                territoryslug = index['territoryslug'];
                //$('#details tbody').append('<tr><td>'+index['territory']+'</td></tr>');
                $(response['candidates']).each(function (a, b) {
                    $(index['rezultat']).each(function (c, d) {
                        if (b['kandidat'] == d['kandidat']) {

                            candidatesterritory_glasova = d['rezultat']['glasova'];
                            //$('#details tbody tr').append('<td>'+d['rezultat']['glasova']+'</td>');
                            createdarray.push({
                                "territory": territory,
                                "territoryslug": territoryslug,
                                'glasova': candidatesterritory_glasova,
                                'candidate': d['kandidatSlug'],
                                'boja': d['boja']

                            });
                        }
                    })

                })

                var exists_territory = "";
                var exists_territory_slug = "";
                var glasova = [];

                max_glasova = [];
                var find_max;

                function getMax(array) {
                    return Math.max.apply(Math, array);
                }

                $(createdarray).each(function (a, b) {
                    if (index['territoryslug'] == b['territoryslug']) {
                        max_glasova.push(b[['glasova']]);

                        exists_territory = b['territory'];
                        exists_territory_slug = b['territoryslug'];
                        glasova.push({'glasova': b['glasova'], 'candidate': b['candidate'], 'boja': b['boja']});

                    }
                })

                var boja_selected = "";
                $(glasova).each(function (a, b) {
                    if (b['glasova'] >= getMax(max_glasova)) {
                        boja_selected = b['boja'];
                    }
                })

                mergearray.push({
                    'territory': exists_territory,
                    'rezults': glasova,
                    'territoryslug': exists_territory_slug,
                    'boja': boja_selected
                });
                //console.log(mergearray);

            })


            $(mergearray).each(function (a, b) {
                if (b['territory'] != "") {
                    {% if g.current_lang=="en" %}
                        $('#details tbody').append('<tr class=' + b['territoryslug'] + '><td>' + transliterateToEnglish(b['territory']) + '</tr>');
                    {% else %}
                         $('#details tbody').append('<tr class=' + b['territoryslug'] + '><td>' + b['territory'] + '</tr>');
                    {% endif %}
                    $(b['rezults']).each(function (aa, bb) {

                        if (aa <= arraylength) {
                            var color = "";
                            if (b['boja'] == bb['boja']) {
                                color = bb['boja'];
                            }
                            $('#details tbody tr.' + b['territoryslug']).append('<td  href="#" data-territory-slug=' + b['territoryslug'] + ' data-territory=' + b['territory'] + ' data-candidate=' + bb['candidate'] + ' style="display:none;background:' + color + '" class="data_glasova selected_' + bb['candidate'] + ' territory_redirect"><a  href="#">' + bb['glasova'].toLocaleString() + '</a></td>')
                        }

                    })
                }
                //console.log(find_max);
            })

            function init_map_territory_selected(response, selected_territory, selected_candidate) {
                $('.party_info').hide();
                var chart;

                $.getJSON('{{ url_for("static",filename="data/serbia-municipality.geojson") }}', function (geojson) {
                    var data = [];
                    var data1 = [];
                    $(response['winners']).each(function (index, value) {
                        $(value['rezultat']).each(function (a, b) {
                            if (selected_territory == value['teritorija'] && b['kandidatSlug'] == selected_candidate) {
                                data.push
                                ({
                                    "teritorija": transliterate(value['teritorija']),
                                    "terrigorySlug": transliterate(value['teritorijaSlug']),
                                    "value": b['rezultat']['udeo'],
                                    "izbornaLista": selected_candidate,
                                    'color': b['boja'],
                                    'plotBorderColor': 'blue',
                                    'borderColor': "blue",
                                    'plotBackgroundColor': 'blue',
                                    'fill': 'white',
                                    'selected_territorija': 'true',
                                    'borderWidth': 20,

                                });

                            } else if (b['kandidatSlug'] == selected_candidate) {
                                data.push({
                                    "teritorija": transliterate(value['teritorija']),
                                    "terrigorySlug": transliterate(value['teritorijaSlug']),
                                    "value": b['rezultat']['udeo'],
                                    "izbornaLista": selected_candidate,

                                    'dataLabels': ''
                                });
                            }
                        })

                    })


                    chart = $('#containermap').highcharts('Map', {
                        chart: {
                            events: {
                                load: function () {
                                    this.mapZoom(0.5, 21, -44);
                                }

                            },
                            backgroundColor: {
                                linearGradient: {x1: 0, y1: 0, x2: 0, y2: 1},
                                stops: [
                                    [0, '#edecd1'],
                                    [1, '#edecd1']
                                ]
                            },

                        },

                        title: {
                            text: ''
                        },
                        tooltip: {
                            'enabled': false
                        },
                        plotOptions: {
                            series: {
                                dataLabels: {
                                    enabled: true,
                                    useHTML: true,
                                    formatter: function () {

                                        if (transliterate(selected_territory) == this.point.NAME_2) {
                                            {% if g.current_lang=="en" %}
                                                return ("<span  style='padding:20px;overflow: auto;display:block;background:white;border-radius:3px;'><a href='#' class='remove-popup'><img style='float:right;margin-top:-15px;margin-right:-14px;'src='{{ url_for('static', filename = 'assets/popup-close.png') }}'/></a><span class='datalabel' style='float:left;color:black;'>" + transliterateToEnglish(selected_territory) + "</span></span><div id='Feature Popup_FrameDecorationDiv_4' style='position: absolute; overflow: hidden; width: 81px; height: 35px; left: 0px;'><img src='{{ url_for('static', filename = 'assets/arrow-popup.png') }}' style='width: 1276px; height: 736px; position: absolute; left: -215px; top: -690px;'/></div>");
                                            {% else %}
                                                return ("<span  style='padding:20px;overflow: auto;display:block;background:white;border-radius:3px;'><a href='#' class='remove-popup'><img style='float:right;margin-top:-15px;margin-right:-14px;'src='{{ url_for('static', filename = 'assets/popup-close.png') }}'/></a><span class='datalabel' style='float:left;color:black;'>" + selected_territory + "</span></span><div id='Feature Popup_FrameDecorationDiv_4' style='position: absolute; overflow: hidden; width: 81px; height: 35px; left: 0px;'><img src='{{ url_for('static', filename = 'assets/arrow-popup.png') }}' style='width: 1276px; height: 736px; position: absolute; left: -215px; top: -690px;'/></div>");
                                            {% endif %}
                                        }
                                    }
                                },
                                allowPointSelect: true,
                                cursor: 'pointer',
                                point: {
                                    events: {
                                        click: function () {
                                            var terrritory_selected_slug = this.terrigorySlug;
                                            var terrritory_selected = this.teritorija;
                                            var izbornaLista = this.izbornaLista;

                                            on_reinit_map_click(response, terrritory_selected_slug, this.izbornaLista, terrritory_selected);
                                        }
                                    }
                                }
                            }
                        },
                        mapNavigation: {
                            enableMouseWheelZoom: false,
                            enabled: true,
                            buttonOptions: {
                                verticalAlign: 'bottom'
                            }
                        },
                        colorAxis: {
                            min: 0
                        },
                        {# tooltip : {
                            formatter: function() {
                                    console.log(this.point);
                                    tooltip =  '<span style="color:{point.color}">●</span> <span style="font-size: 0.85em;position:fixed;display:block;">'+this.point.NAME_2+'</span><br/>';

                            }
                        },#}
                        series: [{
                            data: data,
                            mapData: geojson,
                            joinBy: ['NAME_2', 'teritorija'],
                            keys: ['NAME_2', 'NAME_1'],
                            //animation: true,
                            name: 'Teritorija',

                            {#  dataLabels: {
                                 enabled: true,
                                 color: '#FFFFFF',

                             }#}
                        }],
                    });
                }).done(function () {
                    $('.remove-popup').on('click', function (e) {
                        e.preventDefault();
                        e.stopPropagation();
                        $('.party_name').removeClass('select-p-tab');
                        $('#start-map').addClass('select-p-tab');
                        init_results(response);

                    })
                    {# console.log(data);
                     getSelectedTeritorijaIndex(chart, chart.highcharts().series[0].data, selected_territory);
                     return chart;#}
                });


            }


            {#function getSelectedTeritorijaIndex(chart, array, territorija){
                $.each(array, function(idx, item){
                    if (item['teritorija'] != undefined) {
                        if (transliterate(item['teritorija']) == transliterate(territorija)) {
                            console.log( chart.highcharts().series[0].data[idx]);

                             #}{#chart.highcharts().series[0].tooltipOptions.headerFormat='<span style="color:{point.color}">●</span> <span style="font-size: 0.85em;position:fixed;display:block;">'+territorija+'</span><br/>';
                            chart.highcharts().series[0].tooltipOptions.pointFormat="";
                            chart.highcharts().series[0].data[idx].setState('hover');
                            chart.highcharts().tooltip.refresh(chart.highcharts().series[0].data[idx]);#}{#

                        }
                    }
                })
            }#}

            $('.territory_redirect').on("click", function (e) {
                e.preventDefault();
                var territory_slug = $(this).data("territory-slug");
                var territory = $(this).data("territory");
                var candidate = $(this).data("candidate");
                $('#containermap').html('');
                $('.party_info').show();
                var territorija = [];
                $(response['winners']).each(function (key, index) {
                    if (territory_slug == index['teritorijaSlug']) {
                        territorija.push(index);
                    }
                });
                $('.party_name').removeClass('select-p-tab');
                init_map_territory_selected(response, territory, candidate);
                //console.log(response['winners']);
                $(response['winners']).each(function (index, value) {
                    $(value['rezultat']).each(function (index1, value1) {
                        if (candidate == value1['kandidatSlug'] && territory == value['teritorija']) {
                        }
                    })
                    // console.log(value['teritorija']);
                    // console.log(territory);
                })
                winner_territory_info(response, territorija, candidate);
                $('html, body').animate({scrollTop: 0}, 'slow');
                $('.party_info').show();
                $('#start-map').removeClass('select-p-tab');
                $('.party_name').removeClass('select-p-tab');
                $("a[href=" + candidate + "]").addClass('select-p-tab');

            });
        }
    {% endif %}


    // end of details table
    // summry table
    function init_summary_table(response) {

        $.each(response['winners'], function (key, index) {
            if (index['teritorija'] != "") {
                var resigtered_voters = index['brojUpisanihBiracaUBirackiSpisak'];
                var voters = index['biraciKojiSuGlasali'];
                var percentage = (voters / resigtered_voters) * 100;
                var remove = 100 - index['percentage'];

                {% if typeizbori=="parlamentarni" %}
                        {% if g.current_lang=="en" %}
                    $('#summary tbody').append('<tr><td>' + transliterateToEnglish(index['teritorija']) + '</td>' +
                            '<td ><span style="color:' + index['rezultat'][0]['boja'] + '">' + transliterateToEnglish(index['rezultat'][0]['izbornaLista']) + '</span><br/><span style="color:' + index['rezultat'][1]['boja'] + '">' + transliterateToEnglish(index['rezultat'][1]['izbornaLista']) + '</span></td>' +
                            '<td>' +
                            '<span style="color:' + index['rezultat'][0]['boja'] + '" class="float-left font-size-12 table-votes col-md-3">' + index['rezultat'][0]['rezultat']['glasova'].toLocaleString() + '</span>' +
                            '<div class="col-md-7">' +
                            '<div class="progress">' +
                            '<div class="progress-bar" style="width:' + index['rezultat'][0]['rezultat']['udeo'] + '%;background:' + index['rezultat'][0]['boja'] + '" role="progressbar" aria-valuenow=' + index['rezultat'][0]['rezultat']['udeo'] + ' aria-valuemin="0" aria-valuemax="100">' +
                            '<span class="sr-only">' + index['rezultat'][0]['rezultat']['udeo'] + '</span>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '<div style="color:' + index['rezultat'][0]['boja'] + '" class="col-md-2 percentage font-size-12">' + index['rezultat'][0]['rezultat']['udeo'].toFixed(2) + '%</div>' +

                            '<span style="color:' + index['rezultat'][1]['boja'] + '" class="float-left font-size-12 table-votes col-md-3">' + index['rezultat'][1]['rezultat']['glasova'].toLocaleString() + '</span>' +
                            '<div class="col-md-7">' +
                            '<div class="progress">' +
                            '<div class="progress-bar" style="width:' + index['rezultat'][1]['rezultat']['udeo'] + '%;background:' + index['rezultat'][1]['boja'] + '" role="progressbar" aria-valuenow=' + index['rezultat'][1]['rezultat']['udeo'] + ' aria-valuemin="0" aria-valuemax="100">' +
                            '<span class="sr-only">' + index['rezultat'][1]['rezultat']['udeo'] + '</span>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '<div style="color:' + index['rezultat'][1]['boja'] + '" class="col-md-2 percentage font-size-12 col-md-3">' + index['rezultat'][1]['rezultat']['udeo'].toFixed(2) + '%</div>' +
                            '</td>' +
                            '<td>' +
                            '<div class="x0" style="width:60%;height:200px;margin-top:-50px;">' +
                            '<div class="x1" style="width:300px">' +
                            ' <div class="x2" style="position:relative;float:right">' +
                            '<div class="x3" style="">' +
                            '<div class="x6">' +
                            '<div class="x7" style="width:' + index["percentage"] + '%">' +

                            '</div>' +
                            '<div class="x8" id="pierow_' + key + '">' +
                            '</div>' +
                            '</div>' +
                            '<div class="x3" id="piechar-votes">{{ _('Излазност')}}: <span class="total_voters_value">' + index['biraciKojiSuGlasali'].toLocaleString() + '</span></div>' +
                            '<span class="percentage-value" style="color:white;"><span>' + index['percentage'].toFixed(2) + '</span>%</span>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</td>' +
                            '</tr>');
                            {% else %}
                             $('#summary tbody').append('<tr><td>' + index['teritorija'] + '</td>' +
                            '<td ><span style="color:' + index['rezultat'][0]['boja'] + '">' + index['rezultat'][0]['izbornaLista'] + '</span><br/><span style="color:' + index['rezultat'][1]['boja'] + '">' + index['rezultat'][1]['izbornaLista'] + '</span></td>' +
                            '<td>' +
                            '<span style="color:' + index['rezultat'][0]['boja'] + '" class="float-left font-size-12 table-votes col-md-3">' + index['rezultat'][0]['rezultat']['glasova'].toLocaleString() + '</span>' +
                            '<div class="col-md-7">' +
                            '<div class="progress">' +
                            '<div class="progress-bar" style="width:' + index['rezultat'][0]['rezultat']['udeo'] + '%;background:' + index['rezultat'][0]['boja'] + '" role="progressbar" aria-valuenow=' + index['rezultat'][0]['rezultat']['udeo'] + ' aria-valuemin="0" aria-valuemax="100">' +
                            '<span class="sr-only">' + index['rezultat'][0]['rezultat']['udeo'] + '</span>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '<div style="color:' + index['rezultat'][0]['boja'] + '" class="col-md-2 percentage font-size-12">' + index['rezultat'][0]['rezultat']['udeo'].toFixed(2) + '%</div>' +

                            '<span style="color:' + index['rezultat'][1]['boja'] + '" class="float-left font-size-12 table-votes col-md-3">' + index['rezultat'][1]['rezultat']['glasova'].toLocaleString() + '</span>' +
                            '<div class="col-md-7">' +
                            '<div class="progress">' +
                            '<div class="progress-bar" style="width:' + index['rezultat'][1]['rezultat']['udeo'] + '%;background:' + index['rezultat'][1]['boja'] + '" role="progressbar" aria-valuenow=' + index['rezultat'][1]['rezultat']['udeo'] + ' aria-valuemin="0" aria-valuemax="100">' +
                            '<span class="sr-only">' + index['rezultat'][1]['rezultat']['udeo'] + '</span>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '<div style="color:' + index['rezultat'][1]['boja'] + '" class="col-md-2 percentage font-size-12 col-md-3">' + index['rezultat'][1]['rezultat']['udeo'].toFixed(2) + '%</div>' +
                            '</td>' +
                            '<td>' +
                            '<div class="x0" style="width:60%;height:200px;margin-top:-50px;">' +
                            '<div class="x1" style="width:300px">' +
                            ' <div class="x2" style="position:relative;float:right">' +
                            '<div class="x3" style="">' +
                            '<div class="x6">' +
                            '<div class="x7" style="width:' + index["percentage"] + '%">' +

                            '</div>' +
                            '<div class="x8" id="pierow_' + key + '">' +
                            '</div>' +
                            '</div>' +
                            '<div class="x3" id="piechar-votes">{{ _('Излазност') }}: <span class="total_voters_value">' + index['biraciKojiSuGlasali'].toLocaleString() + '</span></div>' +
                            '<span class="percentage-value" style="color:white;"><span>' + index['percentage'].toFixed(2) + '</span>%</span>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</td>' +
                            '</tr>');
                        {% endif %}
                    $('#total_percentage_value_territory_' + key).html(percentage.toFixed(2));
                    $('#pierow_' + key).css('width', remove + "%");
                {% else %}
                {% if g.current_lang=="en" %}
                    $('#summary tbody').append('<tr><td>' + transliterateToEnglish(index['teritorija']) + '</td>' +
                            '<td ><span style="color:' + index['rezultat'][0]['boja'] + '">' + transliterateToEnglish(index['rezultat'][0]['kandidat']) + '</span><br/><span style="color:' + index['rezultat'][1]['boja'] + '">' + transliterateToEnglish(index['rezultat'][1]['kandidat']) + '</span></td>' +
                            '<td>' +
                            '<span style="color:' + index['rezultat'][0]['boja'] + '" class="float-left font-size-12 table-votes col-md-3">' + index['rezultat'][0]['rezultat']['glasova'].toLocaleString() + '</span>' +
                            '<div class="col-md-7">' +
                            '<div class="progress">' +
                            '<div class="progress-bar" style="width:' + index['rezultat'][0]['rezultat']['udeo'] + '%;background:' + index['rezultat'][0]['boja'] + '" role="progressbar" aria-valuenow=' + index['rezultat'][0]['rezultat']['udeo'] + ' aria-valuemin="0" aria-valuemax="100">' +
                            '<span class="sr-only">' + index['rezultat'][0]['rezultat']['udeo'] + '</span>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '<div style="color:' + index['rezultat'][0]['boja'] + '" class="col-md-2 percentage font-size-12">' + index['rezultat'][0]['rezultat']['udeo'].toFixed(2) + '%</div>' +

                            '<span style="color:' + index['rezultat'][1]['boja'] + '" class="float-left font-size-12 table-votes col-md-3">' + index['rezultat'][1]['rezultat']['glasova'].toLocaleString() + '</span>' +
                            '<div class="col-md-7">' +
                            '<div class="progress">' +
                            '<div class="progress-bar" style="width:' + index['rezultat'][1]['rezultat']['udeo'] + '%;background:' + index['rezultat'][1]['boja'] + '" role="progressbar" aria-valuenow=' + index['rezultat'][1]['rezultat']['udeo'] + ' aria-valuemin="0" aria-valuemax="100">' +
                            '<span class="sr-only">' + index['rezultat'][1]['rezultat']['udeo'] + '</span>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '<div style="color:' + index['rezultat'][1]['boja'] + '" class="col-md-2 percentage font-size-12 col-md-3">' + index['rezultat'][1]['rezultat']['udeo'].toFixed(2) + '%</div>' +
                            '</td>' +
                            '<td>' +
                            '<div class="x0" style="width:60%;height:200px;margin-top:-50px;">' +
                            '<div class="x1" style="width:300px">' +
                            ' <div class="x2" style="position:relative;float:right">' +
                            '<div class="x3" style="">' +
                            '<div class="x6">' +
                            '<div class="x7" style="width:' + index["percentage"] + '%">' +

                            '</div>' +
                            '<div class="x8" id="pierow_' + key + '">' +
                            '</div>' +
                            '</div>' +
                            '<div class="x3" id="piechar-votes">{{ _('Излазност') }}: <span class="total_voters_value">' + index['biraciKojiSuGlasali'].toLocaleString() + '</span></div>' +
                            '<span class="percentage-value" style="color:white;"><span>' + index['percentage'].toFixed(2) + '</span>%</span>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</td>' +
                            '</tr>');
                    {% else %}
                       $('#summary tbody').append('<tr><td>' + index['teritorija'] + '</td>' +
                            '<td ><span style="color:' + index['rezultat'][0]['boja'] + '">' + index['rezultat'][0]['kandidat'] + '</span><br/><span style="color:' + index['rezultat'][1]['boja'] + '">' + index['rezultat'][1]['kandidat'] + '</span></td>' +
                            '<td>' +
                            '<span style="color:' + index['rezultat'][0]['boja'] + '" class="float-left font-size-12 table-votes col-md-3">' + index['rezultat'][0]['rezultat']['glasova'].toLocaleString() + '</span>' +
                            '<div class="col-md-7">' +
                            '<div class="progress">' +
                            '<div class="progress-bar" style="width:' + index['rezultat'][0]['rezultat']['udeo'] + '%;background:' + index['rezultat'][0]['boja'] + '" role="progressbar" aria-valuenow=' + index['rezultat'][0]['rezultat']['udeo'] + ' aria-valuemin="0" aria-valuemax="100">' +
                            '<span class="sr-only">' + index['rezultat'][0]['rezultat']['udeo'] + '</span>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '<div style="color:' + index['rezultat'][0]['boja'] + '" class="col-md-2 percentage font-size-12">' + index['rezultat'][0]['rezultat']['udeo'].toFixed(2) + '%</div>' +

                            '<span style="color:' + index['rezultat'][1]['boja'] + '" class="float-left font-size-12 table-votes col-md-3">' + index['rezultat'][1]['rezultat']['glasova'].toLocaleString() + '</span>' +
                            '<div class="col-md-7">' +
                            '<div class="progress">' +
                            '<div class="progress-bar" style="width:' + index['rezultat'][1]['rezultat']['udeo'] + '%;background:' + index['rezultat'][1]['boja'] + '" role="progressbar" aria-valuenow=' + index['rezultat'][1]['rezultat']['udeo'] + ' aria-valuemin="0" aria-valuemax="100">' +
                            '<span class="sr-only">' + index['rezultat'][1]['rezultat']['udeo'] + '</span>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '<div style="color:' + index['rezultat'][1]['boja'] + '" class="col-md-2 percentage font-size-12 col-md-3">' + index['rezultat'][1]['rezultat']['udeo'].toFixed(2) + '%</div>' +
                            '</td>' +
                            '<td>' +
                            '<div class="x0" style="width:60%;height:200px;margin-top:-50px;">' +
                            '<div class="x1" style="width:300px">' +
                            ' <div class="x2" style="position:relative;float:right">' +
                            '<div class="x3" style="">' +
                            '<div class="x6">' +
                            '<div class="x7" style="width:' + index["percentage"] + '%">' +

                            '</div>' +
                            '<div class="x8" id="pierow_' + key + '">' +
                            '</div>' +
                            '</div>' +
                            '<div class="x3" id="piechar-votes">Излазност: <span class="total_voters_value">' + index['biraciKojiSuGlasali'].toLocaleString() + '</span></div>' +
                            '<span class="percentage-value" style="color:white;"><span>' + index['percentage'].toFixed(2) + '</span>%</span>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</td>' +
                            '</tr>');
                    {% endif %}
                    $('#total_percentage_value_territory_' + key).html(percentage.toFixed(2));
                    $('#pierow_' + key).css('width', remove + "%");

                {% endif %}
            }
        })
    }
    // end of summary table
    function get_territory_name_percentage(teritorija) {
        var registered_voters = teritorija[0]['brojUpisanihBiracaUBirackiSpisak'];
        var voters = teritorija[0]['biraciKojiSuGlasali'];
        var percentage = (voters / registered_voters) * 100;
        $('#territory-name').html('');
          {% if g.current_lang=="en" %}
        $('#territory-name').append("<span> " + transliterateToEnglish(teritorija[0]['teritorija']) + "</span><span style='float:right;margin-right:15px;'>" + Number(percentage).toFixed(2) + "%</span>");
        {% else %}
              $('#territory-name').append("<span> " + teritorija[0]['teritorija'] + "</span><span style='float:right;margin-right:15px;'>" + Number(percentage).toFixed(2) + "%</span>");
        {% endif %}
    }

    function party_list_percentage_map(key1, index1) {
        $('.territory_info').show();
        {% if typeizbori=="parlamentarni" %}
            {% if g.current_lang=="en" %}
                $('#party-list').append("<div class='party_list_t'><div id='party-color' style='background-color:" + index1['boja'] + "'></div><div style='float:left;width:70%;'>" + transliterateToEnglish(index1['izbornaLista']) + "</div><div id='party-list-rez'>" + Number(index1['rezultat']['udeo']).toFixed(2) + "%</div></div>");
                {% else %}
                    $('#party-list').append("<div class='party_list_t'><div id='party-color' style='background-color:" + index1['boja'] + "'></div><div style='float:left;width:70%;'>" + index1['izbornaLista'] + "</div><div id='party-list-rez'>" + Number(index1['rezultat']['udeo']).toFixed(2) + "%</div></div>");
                {% endif %}
            {% else %}
                {% if g.current_lang=="en" %}
                    $('#party-list').append("<div class='party_list_t'><div id='party-color' style='background-color:" + index1['boja'] + "'></div><div style='float:left;width:70%;'>" + transliterateToEnglish(index1['kandidat']) + "</div><div id='party-list-rez'>" + Number(index1['rezultat']['udeo']).toFixed(2) + "%</div></div>");
                {% else %}
                    $('#party-list').append("<div class='party_list_t'><div id='party-color' style='background-color:" + index1['boja'] + "'></div><div style='float:left;width:70%;'>" + index1['kandidat'] + "</div><div id='party-list-rez'>" + Number(index1['rezultat']['udeo']).toFixed(2) + "%</div></div>");
                {% endif %}
        {% endif %}
    }
    // map click
    function on_map_click(response, territory_selected) {
        if ($iW < 990) {
            $('html, body').animate({scrollTop: 600}, 1000);

        }
        $('.default-first-indicators').hide();
        //alert('More than 960');
        $('#all-results').removeClass('disabled-link');
        $('#territory-name').html('');
        $('#party-list').html('');
        var territorija = [];
        $('#territory-selected').show();
        $('#no-territory-selected').removeClass('col-md-12');
        $('#no-territory-selected').addClass('col-md-6');
        $('#piechart-no-territory-selected').hide();
        $(response['winners']).each(function (key, index) {
            if (territory_selected == index['teritorijaSlug']) {
                territorija.push(index);
            }
        })
        $('#tabs-other').html('');
        $('.territory_info').show();
        $(territorija[0]['rezultat']).each(function (key1, index1) {
            party_list_percentage_map(key1, index1);
        })
        get_territory_name_percentage(territorija);

        $('#all-results').removeClass('disabled_link');
        $('#all-results').css('pointer-events', 'cursor');
        $('#all-results').removeAttr('disabled');
        $('#all-results').addClass('btn-selected-territory');
        {% if g.current_lang=="en" %}
            $('#selected-territory-name').text(transliterateToEnglish(territorija[0]['teritorija']));
        {% else %}
            $('#selected-territory-name').text(territorija[0]['teritorija']);
        {% endif %}
        {% if typeizbori=="parlamentarni" %}
            $('#first-izborna-lista-name,#first-nr-votes-parla,#first-percentage-value-parl').css('color', territorija[0]['rezultat'][0]['boja']);
            $('#second-izborna-lista-name,#second-nr-votes-parla,#second-percentage-value-parl').css('color', territorija[0]['rezultat'][1]['boja']);
            {% if g.current_lang=="en" %}
                $('#first-izborna-lista-name').text(transliterateToEnglish(territorija[0]['rezultat'][0]['izbornaLista']));
                $('#second-izborna-lista-name').text(transliterateToEnglish(territorija[0]['rezultat'][1]['izbornaLista']));
            {% else %}
                $('#first-izborna-lista-name').text(territorija[0]['rezultat'][0]['izbornaLista']);
                $('#second-izborna-lista-name').text(territorija[0]['rezultat'][1]['izbornaLista']);
            {% endif %}
            $('#first-nr-votes-parla').text(territorija[0]['rezultat'][0]['rezultat']['glasova'].toLocaleString());
            $('#second-nr-votes-parla').text(territorija[0]['rezultat'][1]['rezultat']['glasova'].toLocaleString());
            $('#first-progress-parl').css({
                width: territorija[0]['rezultat'][0]['rezultat']['udeo'] + "%",
                background: territorija[0]['rezultat'][0]['boja']
            });
            $('#second-progress-parl').css({
                width: territorija[0]['rezultat'][1]['rezultat']['udeo'] + "%",
                background: territorija[0]['rezultat'][1]['boja']
            });
            $('#first-percentage-parl').text(territorija[0]['rezultat'][0]['rezultat']['udeo']);
            $('#first-percentage-value-parl').text(Number(territorija[0]['rezultat'][0]['rezultat']['udeo']).toFixed(2) + "%");
            $('#second-percentage-value-parl').text(Number(territorija[0]['rezultat'][1]['rezultat']['udeo']).toFixed(2) + "%");
        {% else %}
              {% if g.current_lang=="en" %}
                    $('#first-kandidat-name').text(transliterateToEnglish(territorija[0]['rezultat'][0]['kandidat']));
                    $('#second-kandidat-name').text(transliterateToEnglish(territorija[0]['rezultat'][1]['kandidat']));
              {% else %}
                    $('#first-kandidat-name').text(territorija[0]['rezultat'][0]['kandidat']);
                    $('#second-kandidat-name').text(territorija[0]['rezultat'][1]['kandidat']);
              {% endif %}

            $('#first-nr-votes-pred').text(territorija[0]['rezultat'][0]['rezultat']['glasova'].toLocaleString());
            $('#second-nr-votes-pred').text(territorija[0]['rezultat'][1]['rezultat']['glasova'].toLocaleString());
            $('#first-progress-pred').css({
                width: territorija[0]['rezultat'][0]['rezultat']['udeo'],
                background: territorija[0]['rezultat'][0]['boja']
            });
            $('#second-progress-pred').css({
                width: territorija[0]['rezultat'][1]['rezultat']['udeo'],
                background: territorija[0]['rezultat'][1]['boja']
            });
            $('#first-percentage-value-pred').text(Number(territorija[0]['rezultat'][0]['rezultat']['udeo']).toFixed(2) + "%");
            $('#second-percentage-value-pred').text(Number(territorija[0]['rezultat'][1]['rezultat']['udeo']).toFixed(2) + "%");
            $('#first-percentage-value-pred').css('color', territorija[0]['rezultat'][0]['boja']);
            $('#second-percentage-value-pred').css('color', territorija[0]['rezultat'][1]['boja']);
            $('#first-kandidat-name').css('color', territorija[0]['rezultat'][0]['boja']);
            $('#second-kandidat-name').css('color', territorija[0]['rezultat'][1]['boja']);
            $('#first-nr-votes-pred').css('color', territorija[0]['rezultat'][0]['boja']);
            $('#second-nr-votes-pred').css('color', territorija[0]['rezultat'][1]['boja']);
        {% endif %}

    }

    function on_reinit_map_click(response, territory_selected_slug, candidate_selected, terrritory_selected) {

        var territorija = [];
        $('#territory-selected').show();
        $('#selected-territory-name').text('');

        $('#no-territory-selected').removeClass('col-md-12');
        $('#no-territory-selected').addClass('col-md-6');
        $('#piechart-no-territory-selected').hide();
        $(response['winners']).each(function (key, index) {
            if (territory_selected_slug == index['teritorijaSlug']) {
                territorija.push(index);
            }
        })
        $('#tabs-other').html('');

        get_territory_name_percentage(territorija);
             {% if g.current_lang=="en" %}
            $('#selected-territory-name').text(transliterateToEnglish(territorija[0]['teritorija']));
        {% else %}
            $('#selected-territory-name').text(territorija[0]['teritorija']);
        {% endif %}

        $('#all-results').removeClass('disabled-link');
        $('#all-results').removeAttr('disabled');
        $('#all-results').addClass('btn-selected-territory');


        {% if typeizbori=="parlamentarni" %}
            {% if g.current_lang=="en" %}
                $('#first-izborna-lista-name').text(transliterateToEnglish(territorija[0]['rezultat'][0]['izbornaLista']));
                $('#second-izborna-lista-name').text(transliterateToEnglish(territorija[0]['rezultat'][1]['izbornaLista']));
            {% else %}
                $('#first-izborna-lista-name').text(territorija[0]['rezultat'][0]['izbornaLista']);
                $('#second-izborna-lista-name').text(territorija[0]['rezultat'][1]['izbornaLista']);
            {% endif %}
            $('#first-nr-votes-parla').text(territorija[0]['rezultat'][0]['rezultat']['glasova'].toLocaleString());
            $('#second-nr-votes-parla').text(territorija[0]['rezultat'][1]['rezultat']['glasova'].toLocaleString());
            $('#first-progress-parl').css({
                width: territorija[0]['rezultat'][0]['rezultat']['udeo'] + "%",
                background: territorija[0]['rezultat'][0]['boja']
            });
            $('#second-progress-parl').css({
                width: territorija[0]['rezultat'][1]['rezultat']['udeo'] + "%",
                background: territorija[0]['rezultat'][1]['boja']
            });
            $('#first-percentage-parl').text(territorija[0]['rezultat'][0]['rezultat']['udeo']);
            $('#first-percentage-value-parl').text(Number(territorija[0]['rezultat'][0]['rezultat']['udeo']).toFixed(2) + "%");
            $('#second-percentage-value-parl').text(Number(territorija[0]['rezultat'][1]['rezultat']['udeo']).toFixed(2) + "%");
            $('#first-izborna-lista-name,#first-nr-votes-parla,#first-percentage-value-parl').css('color', territorija[0]['rezultat'][0]['boja']);
            $('#second-izborna-lista-name,#second-nr-votes-parla,#second-percentage-value-parl').css('color', territorija[0]['rezultat'][1]['boja']);
        {% else %}
            {% if g.current_lang=="en" %}
                $('#first-kandidat-name').text(transliterateToEnglish(territorija[0]['rezultat'][0]['kandidat']));
                $('#second-kandidat-name').text(transliterateToEnglish(territorija[0]['rezultat'][1]['kandidat']));
            {% else %}
                $('#first-kandidat-name').text(territorija[0]['rezultat'][0]['kandidat']);
                $('#second-kandidat-name').text(territorija[0]['rezultat'][1]['kandidat']);
            {% endif %}
            $('#first-nr-votes-pred').text(territorija[0]['rezultat'][0]['rezultat']['glasova'].toLocaleString());
            $('#second-nr-votes-pred').text(territorija[0]['rezultat'][1]['rezultat']['glasova'].toLocaleString());
            $('#first-progress-pred').css({
                width: territorija[0]['rezultat'][0]['rezultat']['udeo'],
                background: territorija[0]['rezultat'][0]['boja']
            });
            $('#second-progress-pred').css({
                width: territorija[0]['rezultat'][1]['rezultat']['udeo'],
                background: territorija[0]['rezultat'][1]['boja']
            });
            $('#first-percentage-value-pred').text(Number(territorija[0]['rezultat'][0]['rezultat']['udeo']).toFixed(2) + "%");
            $('#second-percentage-value-pred').text(Number(territorija[0]['rezultat'][1]['rezultat']['udeo']).toFixed(2) + "%");
        {% endif %}

        winner_territory_info(response, territorija, candidate_selected)
    }
    function winner_territory_info(response, territorija, candidate_selected) {
        $('.party_info').show();
        $('#party-territory-name').html('');
        $('#voters_turnout').html('');
        $('#winner-territory').html('');
        $('#winner-party').html('');
        {% if g.current_lang=="en" %}
            $('#party-territory-name').text(transliterateToEnglish(territorija[0]['teritorija']));
        {% else %}
            $('#party-territory-name').text(territorija[0]['teritorija']);
        {% endif %}
        var izbornaLista = candidate_selected;
        var voters_turnout = territorija[0]['rezultat']['glasova'];
        var resigtered_voters = territorija[0]['brojUpisanihBiracaUBirackiSpisak'];
        var voters = territorija[0]['biraciKojiSuGlasali'];
        var percentage = (voters / resigtered_voters) * 100
        var result_votes;
        var percentage_votes;
        $('#voters_turnout').append('<b>{{ _('Укупно Излазност') }}: </b> <span style="float:right;margin-right:20px;">' + percentage.toFixed(2) + '%</span>');
        var candidate_name = "";
        var i = 0;
        {% if typeizbori=="parlamentarni" %}
            $(territorija).each(function (a, b) {
                $(b).each(function (c, d) {
                    $(d['rezultat']).each(function (e, f) {

                        if (candidate_selected == f['izbornaListaSlug']) {
                            percentage_votes = f['rezultat']['udeo'];
                            candidate_name = f['izbornaLista'];
                        }
                    })

                })
            })
        {% else %}
            $(territorija).each(function (a, b) {
                $(b).each(function (c, d) {
                    $(d['rezultat']).each(function (e, f) {

                        if (candidate_selected == f['kandidatSlug']) {
                            percentage_votes = f['rezultat']['udeo'];
                            candidate_name = f['kandidat'];
                        }
                    })

                })
            })
        {% endif %}


        //  $('#winner-territory').append("<span>" + candidate_name + "</span><span style='float:right;margin-right:20px'>" + percentage_votes.toFixed(2) + "%</span>");
        {% if typeizbori=="parlamentarni" %}
            var winner = territorija[0]['rezultat'][0]['izbornaLista'];
            var winner_percentage = Number(territorija[0]['rezultat'][0]['rezultat']['udeo']).toFixed(2);
            {% if g.current_lang=="en" %}
                $('#winner-party').append("<span style=''>{{ _('победник') }}: " + transliterateToEnglish(winner) + "</span><span style='float:right;margin-right:20px;'>" + winner_percentage + "%</span>");
                {% else %}
                $('#winner-party').append("<span style=''>{{ _('победник') }}: " + winner + "</span><span style='float:right;margin-right:20px;'>" + winner_percentage + "%</span>");
            {% endif %}
            {% else %}
            var winner = territorija[0]['rezultat'][0]['kandidat'];
            var winner_percentage = Number(territorija[0]['rezultat'][0]['rezultat']['udeo']).toFixed(2);
            {% if g.current_lang=="en" %}
                $('#winner-party').append("<span style=''>{{ _('победник') }}: " + transliterateToEnglish(winner) + "</span><span style='float:right;margin-right:20px;'>" + winner_percentage + "%</span>");
                {% else %}
                $('#winner-party').append("<span style=''>{{ _('победник') }}: " + winner + "</span><span style='float:right;margin-right:20px;'>" + winner_percentage + "%</span>");
            {% endif %}
        {% endif %}
    }
    // end of map click
    //initiliaze map click
    function init_map(response) {
        $('.party_info').hide();
        $.getJSON('{{ url_for("static",filename="data/serbia-municipality.geojson") }}', function (geojson) {
            var data = [];
            var i = 0;
            $.each(response['winners'], function (index, value) {


                data.push({
                    "teritorija": transliterate(value['teritorija']),
                    "terrigorySlug": transliterate(value['teritorijaSlug']),
                    "color": value['rezultat'][0]['boja'],
                    "izbornaLista": ""
                });

            })

            <!-- remove legend -->
            {#$(response['candidates']).each(function (a, b) {
                $('#map-legend').append('<p style="float:left"><span style="width:20px;height:20px;margin-right:10px;margin-left:10px;float:left;background-color:' + b['boja'] + '"></span><span>' + b['izbornaLista'] + '</span></p>')
            })#}

            $('#containermap').highcharts('Map', {
                chart: {
                    events: {
                        load: function () {
                            this.mapZoom(0.5, 21, -44);
                        }

                    },

                    backgroundColor: {
                        linearGradient: {x1: 0, y1: 0, x2: 0, y2: 1},
                        stops: [
                            [0, '#edecd1'],
                            [1, '#edecd1']
                        ]
                    }
                },
                title: {
                    text: ''
                },

                tooltip: {
                    'enabled': false
                },
                plotOptions: {
                    series: {
                        cursor: 'pointer',
                        point: {
                            events: {
                                click: function () {
                                    var terrritory_selected = this.terrigorySlug;
                                    on_map_click(response, terrritory_selected);
                                }
                            }
                        }
                    }
                },
                mapNavigation: {
                    enableMouseWheelZoom: false,
                    enabled: true,
                    buttonOptions: {
                        verticalAlign: 'bottom'
                    }
                },
                colorAxis: {
                    min: 0
                },

                series: [{
                    showInLegend: true,
                    data: data,
                    mapData: geojson,
                    joinBy: ['NAME_2', 'teritorija'],
                    keys: ['NAME_2', 'NAME_1'],
                    animation: true,

                    borderColor: 'black',
                    borderWidth: 1,
                     {# dataLabels: {
                      enabled: true,
                      color: '#FFFFFF',
                      format: '{point.NAME_2}'
                  },#}
                }]
            });
        });
    }
    function isInArray(array, search) {
        return array.indexOf(search) >= 0;
    }
    //first indicators components on default map
    function default_first_indicators(response) {
        var array_list = [];
        var candidate_one_color = [];
        $(response['winners']).each(function (index, value) {
            $(value).each(function (index, indicator) {
                {% if typeizbori=="parlamentarni" %}
                    if (isInArray(array_list, indicator['rezultat'][0]['izbornaLista'])) {
                    } else {
                        array_list.push(indicator['rezultat'][0]['izbornaLista']);
                    }
                {% else %}
                    if (isInArray(array_list, indicator['rezultat'][0]['kandidat'])) {
                    } else {
                        array_list.push(indicator['rezultat'][0]['kandidat']);
                    }
                {% endif %}

            })
        })
        var candidates_color = [];
        {% if typeizbori=="parlamentarni" %}
            $(response['candidates']).each(function (index, value) {
                $(array_list).each(function (a, b) {
                    if (b == value['izbornaLista']) {
                        candidates_color.push({'candidates': value['izbornaLista'], 'boja': value['boja']});
                    }
                })
            })
            $(candidates_color).each(function (a, b) {
            {% if g.current_lang=="en" %}
                $('#list-indicators').append("<div class='party_list_t'><div id='party-color' style='background-color:" + b['boja'] + "'></div><div style='float:left;width:70%;'>" + transliterateToEnglish(b['candidates']) + "</div></div>");

                {% else %}
                $('#list-indicators').append("<div class='party_list_t'><div id='party-color' style='background-color:" + b['boja'] + "'></div><div style='float:left;width:70%;'>" + b['candidates'] + "</div></div>");
            {% endif %}
            });
        {% else %}
            $(response['candidates']).each(function (index, value) {
                $(array_list).each(function (a, b) {
                    if (b == value['kandidat']) {
                        candidates_color.push({'candidates': value['kandidat'], 'boja': value['boja']});
                    }
                })
            })
            $(candidates_color).each(function (a, b) {
                 {% if g.current_lang=="en" %}
                $('#list-indicators').append("<div class='party_list_t'><div id='party-color' style='background-color:" + b['boja'] + "'></div><div style='float:left;width:70%;'>" + transliterateToEnglish(b['candidates']) + "</div></div>");
                     {% else %}
                     $('#list-indicators').append("<div class='party_list_t'><div id='party-color' style='background-color:" + b['boja'] + "'></div><div style='float:left;width:70%;'>" + b['candidates'] + "</div></div>");
                 {% endif %}
            });
        {% endif %}
    }

    // call functions on windows load
    $(window).load(function () {

        if ($iW < 1000) {
            $('#containermap').css('height', '400px');

        } else {
            $('#containermap').css('height', '900px');
        }

        if ($iW < 990) {
            $('.type-initial-results').insertAfter('.map-div');
            $('.type-initial-results').insertBefore('.indicators');
            $('.territory_info').insertBefore('.indicators');
        }
        Highcharts.setOptions({
            lang: {
                printChart: "принт графикон",
                downloadPNG: "Пнг слика за преузимање",
                downloadJPEG: "ЈПЕГ слика Преузимање",
                downloadPDF: "Преузмите ПДФ документ",
                downloadSVG: "СВГ вектор слику Преузимање"
            }
        });
        $(".loader").css("display", "none");

        {% if year!=0 %}
            $.ajax({
                type: "GET",
                {% if typeizbori=="predsjednicki" %}
                    {% if status=="ponovljeni" %}
                        url: "{{ url_for("static",filename="data/presidential/") }}{{ year }}-{{ krug }}-krug-ponovljeni.json",
                    {% else %}
                        url: "{{ url_for("static",filename="data/presidential/") }}{{ year }}-{{ krug }}-krug.json",
                    {% endif %}
                {% else %}
                    url: "{{ url_for("static",filename="data/parlamentarni/") }}{{ year }}.json",
                {% endif %}
                //url: "http://0.0.0.0:5006/api/izbori/2/{{ typeizbori }}/godina/{{ year }}/instanca/3/krug/{{ krug }}",
                beforeSend: function () {
                        $('#containermap').css('visibility','hidden');
                        $('.ajax-loader').css("visibility", "visible");
                    },
                async: false,
                dataType: 'json',
                success: function (response) {
                    var text = $('.highcharts-menu-item').text();
                    $('.highcharts-menu-item').html(text.replace('Print chart', 'test'));
                    init_map(response);
                    init_details_table(response);
                    init_summary_table(response);

                    default_first_indicators(response);

                    {% if g.current_lang=="sr" %}
                    $('#summary').DataTable({
                        "language": {
                            "url": "{{ url_for("static",filename="data/datatable_translate.json")}}"
                        },

                    });
                    $('#details').DataTable({
                        "language": {
                            "url": "{{ url_for("static",filename="data/datatable_translate.json")}}"
                        },

                    });
                    {% endif %}
                     {% if g.current_lang!="sr" %}
                    $('#summary').DataTable();
                    $('#details').DataTable();
                    {% endif %}
                    fill_html(response);
                },
              complete: function () {
                        $('.ajax-loader').css("visibility", "hidden");
                        $('#containermap').css('visibility', 'visible');
                    },
                error: function (error) {
                    console.log(error);
                }
            });
        {% endif %}
    })

    {% if year!=0 %}
        // end of window load
        // restar results from beginning - no selections
        function init_results() {
            $('#containermap').html();
            $('#territory-selected').hide();

            $('#no-territory-selected').removeClass('col-md-6');
            $('#no-territory-selected').addClass('col-md-9');
            $('#piechart-no-territory-selected').show();
            $('.territory_info').hide();
            $('.default-first-indicators').show();
            $.ajax({
                type: "GET",

                {% if typeizbori=="predsjednicki" %}
                    url: "{{ url_for("static",filename="data/presidential/") }}{{ year }}-{{ krug }}-krug.json",
                {% else %}
                    url: "{{ url_for("static",filename="data/parlamentarni/") }}{{ year }}.json",
                {% endif %}
                //url: "http://0.0.0.0:5006/api/izbori/2/{{ typeizbori }}/godina/{{ year }}/instanca/3/krug/{{ krug }}",
                async: false,
                dataType: 'json',
                success: function (response) {
                    $('#map-legend').html('');
                    init_map(response);
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }
    {% endif %}

    $.extend($.fn.dataTableExt.oStdClasses, {
        "sFilterInput": "form-control",
        "sLengthSelect": "form-control"
    });
    $('#all-results').click(function (e) {
        e.preventDefault();
        $('.tabs_table').show();
        $('#heatmap').removeClass('btn-selected-territory');

        if (heatmap_active == 1) {
            map.remove();
            heatmapLayer = new HeatmapOverlay(cfg);
            baseLayer = L.tileLayer(
                    'http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                        maxZoom: 18
                    }
            );

            var jsonArr = [];
            data_array = {
                max: 3000,
                data: ''
            };
            heatmapLayer.setData(data_array);
            heatmap_active = 0;
        }

        $('#containerheatmap').hide();
        $('#containermap').show();

        e.preventDefault();
        $(this).addClass('disabled-link');
        $(this).removeClass('btn-selected-territory');
        $(this).attr('disabled', 'disabled');
        init_results();
    });
    $('#start-map').on('click', function (e) {
        $('.tabs_table').show();
        $('#all-results').removeClass('btn-selected-territory');
        $('#heatmap').removeClass('btn-selected-territory');

        if (heatmap_active == 1) {
            map.remove();
            heatmapLayer = new HeatmapOverlay(cfg);
            baseLayer = L.tileLayer(
                    'http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                        maxZoom: 18
                    }
            );
            var jsonArr = [];
            data_array = {
                max: 3000,
                data: ''
            };
            heatmapLayer.setData(data_array);
            heatmap_active = 0;
        }
        e.preventDefault();
        $('#containerheatmap').hide();
        $('#containermap').show();
        $('#party-list-names li a').removeClass('select-p-tab');

        init_results();
    });
     function download(filename, text) {
        var pom = document.createElement('a');
        pom.setAttribute('href', 'data:json;charset=utf-8,' + encodeURIComponent(text));
        pom.setAttribute('download', filename);

        if (document.createEvent) {
            var event = document.createEvent('MouseEvents');
            event.initEvent('click', true, true);
            pom.dispatchEvent(event);
        }
        else {
            pom.click();
        }
    }
    $('#d_json').click(function () {
        $.ajax({
            type: "GET",
            {% if typeizbori=="parlamentarni" %}
                url: "{{ url_for("static",filename="data/download/json/parlamentarni/") }}parlamentarni_{{ year }}.json",
            {% endif %}
            {% if typeizbori=="predsjednicki" and status=="ponovljeni" %}
                url: "{{ url_for("static",filename="data/download/json/presidential/") }}predsjednicki_{{ year }}_{{ krug }}_krug_ponovljeni.json",
            {% endif %}
            {% if typeizbori=="predsjednicki" and status!="ponovljeni" %}
                url: "{{ url_for("static",filename="data/download/json/presidential/") }}predsjednicki_{{ year }}_{{ krug }}_krug.json",
            {% endif %}
            async: false,
            dataType: 'json',
            success: function (response) {
                {% if typeizbori=="predsjednicki" and status!="ponovljeni" %}
                    download('predsjednicki-{{ year }}-{{ krug }}-krug.json', JSON.stringify(response['winners']));
                {% endif %}
                {% if typeizbori=="predsjednicki" and status=="ponovljeni" %}
                    download('predsjednicki-{{ year }}-{{ krug }}-krug-ponovjleni.json', JSON.stringify(response['winners']));
                {% endif %}
                {% if typeizbori=="parlamentarni" %}

                    download('parlamentarni-{{ year }}.json', JSON.stringify(response['winners']));
                {% endif %}
            },
            error: function (error) {
                console.log(error);
            }

        });
    });

  $('#d_csv').click(function (){
                {% if typeizbori=="predsjednicki" and status!="ponovljeni" %}
                    $(this).prop("href", "{{ url_for("static",filename="data/download/csv/predsjednicki/") }}predsjednicki_{{ year }}_{{ krug }}_krug.csv");
                {% endif %}
                {% if typeizbori=="predsjednicki" and status=="ponovljeni" %}
                    $(this).prop("href", "{{ url_for("static",filename="data/download/csv/predsjednicki/") }}predsjednicki_{{ year }}_{{ krug }}_krug_ponovljeni.csv");
                {% endif %}
                {% if typeizbori=="parlamentarni" %}
                     $(this).prop("href", "{{ url_for("static",filename="data/download/csv/parlamentarni/") }}parlamentarni_{{ year }}.csv");
                {% endif %}
        });
    $('.download_types').toggle();
    $('#link_download').click(function(e){
        e.preventDefault();
        $('.download_types').toggle();
    });
</script>
<style>

    .party_list_t {
        font-size: 12px;
        padding-bottom: 10px;
        padding-top: 10px;
        display: block;
        clear: both;
        word-wrap: break-word;
    }

    #party-color {
        font-size: 10px;
        margin-left: 10px;
        margin-right: 10px;
        width: 10px;
        height: 30px;
        float: left;

    }
    #link_download,.download_types{
        cursor: pointer;
        float:left;
        padding:10px;
        background: #337ab7;
        color:white;
    }
    .download_types a{
        color:white;
    }
    #party-list-rez {
        float: right;
        margin-right: 20px;
    }
    {##containermap {
    background: url("{{ url_for('static', filename = 'assets/background-map') }}") 50% 50% no-repeat rgb(249, 249, 249)repeat;
}#}
</style>